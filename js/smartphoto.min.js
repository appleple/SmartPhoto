/**
 * Modules in this bundle
 * @license
 *
 * smartphoto:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: appleple
 *   homepage: http://developer.a-blogcms.jp
 *   version: 0.5.10
 *
 * a-template:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: steelydylan
 *   version: 0.2.0
 *
 * delegate:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   version: 3.1.2
 *
 * es6-promise-polyfill:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Roman Dvornov <rdvornov@gmail.com>
 *   version: 1.2.0
 *
 * morphdom:
 *   license: MIT (http://opensource.org/licenses/MIT)
 *   author: Patrick Steele-Idem <pnidem@gmail.com>
 *   version: 2.3.1
 *
 * This header is generated by licensify (https://github.com/twada/licensify)
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.smartPhoto=t()}}(function(){var t;return function t(e,a,o){function i(r,s){if(!a[r]){if(!e[r]){var h="function"==typeof require&&require;if(!s&&h)return h(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[r]={exports:{}};e[r][0].call(d.exports,function(t){var a=e[r][1][t];return i(a||t)},d,d.exports,t,e,a,o)}return a[r].exports}for(var n="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(t,e,a){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,a,o){return a&&t(e.prototype,a),o&&t(e,o),e}}(),n=t("morphdom"),r=t("delegate"),s=[],h="input paste copy click change keydown keyup contextmenu mouseup mousedown mousemove touchstart touchend touchmove compositionstart compositionend",c=h.replace(/([a-z]+)/g,"[data-action-$1],")+"[data-action]";Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e=Object(this),a=e.length>>>0,o=arguments[1],i=void 0,n=0;n<a;n++)if(i=e[n],t.call(o,i,n,e))return i}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),a=e.length;--a>=0&&e.item(a)!==this;);return a>-1});var d=function(t){return document.querySelector(t)},l=function(t){for(var e=0,a=s.length;e<a;e++)for(var o=s[e],i=o.templates,n=0,r=i.length;n<r;n++)if(i[n]==t)return o;return null},u=function(t,e){if("function"==typeof t.closest)return t.closest(e)||null;for(;t;){if(t.matches(e))return t;t=t.parentElement}return null},f=function(t,e,a,o){a.split(" ").forEach(function(a){r(t,e,a,o)})};"undefined"!=typeof document&&(f(document,"[data-bind]","input change click",function(t){var e=t.delegateTarget,a=e.getAttribute("data-bind"),o=e.getAttribute("href"),i=u(e,"[data-id]").getAttribute("data-id"),n=e.value;if(o&&(n=n.replace("#","")),i){var r=l(i);"radio"===e.getAttribute("type")||("checkbox"===e.getAttribute("type")?function(){var t=[],e=document.querySelectorAll('[data-bind="'+a+'"]');[].forEach.call(e,function(e){e.checked&&t.push(e.value)})}():r.updateDataByString(a,n))}}),f(document,c,h,function(t){var e=t.delegateTarget;if(!("click"===t.type&&"select"===e.tagName||"input"===t.type&&"button"===e.getAttribute("type"))){var a=h.split(" "),o="action";a.forEach(function(a){e.getAttribute("data-action-"+a)&&t.type===a&&(o+="-"+a)});var i=e.getAttribute("data-"+o);if(i){var n=i.replace(/\(.*?\);?/,""),r=i.replace(/(.*?)\((.*?)\);?/,"$2"),s=r.split(","),c=u(e,"[data-id]").getAttribute("data-id");if(c){var d=l(c);d.e=t,d.method&&d.method[n]?d.method[n].apply(d,s):d[n]&&d[n].apply(d,s)}}}}));var p=function(){function t(e){o(this,t),this.atemplate=[],s.push(this);for(var a in e)this[a]=e[a];this.data||(this.data={}),this.templates||(this.templates=[]);for(var i=this.templates,n=i.length,r=0,h=n;r<h;r++){var c=this.templates[r],l=d("#"+c).innerHTML;this.atemplate.push({id:c,html:l})}this.setId()}return i(t,[{key:"addTemplate",value:function(t,e){this.atemplate.push({id:t,html:e}),this.templates.push(t)}},{key:"loadHtml",value:function(){var t=this.templates,e=[];return t.forEach(function(t){var a=new $.Deferred;e.push(a);var o=d("#"+t).getAttribute("src");$.ajax({url:o,type:"GET",dataType:"text"}).success(function(e){d("#"+t).innerHTML=e,a.resolve()})}),$.when.apply($,e)}},{key:"getData",value:function(){return JSON.parse(JSON.stringify(this.data))}},{key:"saveData",value:function(t){var e=JSON.stringify(this.data);localStorage.setItem(t,e)}},{key:"setData",value:function(t){for(var e in t)"function"!=typeof t[e]&&(this.data[e]=t[e])}},{key:"loadData",value:function(t){var e=JSON.parse(localStorage.getItem(t));if(e)for(var a in e)"function"!=typeof e[a]&&(this.data[a]=e[a])}},{key:"getRand",value:function(t,e){return~~(Math.random()*(e-t+1))+t}},{key:"getRandText",value:function(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,i=0;i<t;i++)e+=a.charAt(Math.floor(this.getRand(0,o)));return e}},{key:"setId",value:function(){for(var e=void 0,a=(t.ids,!1);;){e=this.getRandText(10);for(var o=0,i=t.ids;o<i;o++)t.ids[o]===e&&(a=!0);if(!1===a)break}this.data.aTemplate_id=e}},{key:"getDataFromObj",value:function(t,e){t=t.replace(/\[([a-zA-Z0-9._-]+)\]/g,".$1"),t=t.replace(/^\./,"");for(var a=t.split(".");a.length;){var o=a.shift();if(!(o in e))return;e=e[o]}return e}},{key:"getDataByString",value:function(t){var e=this.data;return this.getDataFromObj(t,e)}},{key:"updateDataByString",value:function(t,e){for(var a=this.data,o=t.split(".");o.length>1;)a=a[o.shift()];a[o.shift()]=e}},{key:"removeDataByString",value:function(t){for(var e=this.data,a=t.split(".");a.length>1;)e=e[a.shift()];var o=a.shift();o.match(/^\d+$/)?e.splice(Number(o),1):delete e[o]}},{key:"resolveBlock",value:function(t,e,a){var o=this,i=t.match(/<!-- BEGIN ([a-zA-Z0-9._-]+):touch#([a-zA-Z0-9._-]+) -->/g),n=t.match(/<!-- BEGIN ([a-zA-Z0-9._-]+):touchnot#([a-zA-Z0-9._-]+) -->/g),r=t.match(/<!-- BEGIN ([a-zA-Z0-9._-]+):exist -->/g),s=t.match(/<!-- BEGIN ([a-zA-Z0-9._-]+):empty -->/g);if(i)for(var h=0,c=i.length;h<c;h++){var d=i[h];d=d.replace(/([a-zA-Z0-9._-]+):touch#([a-zA-Z0-9._-]+)/,"($1):touch#($2)");var l=d.replace(/BEGIN/,"END"),u=new RegExp(d+"(([\\n\\r\\t]|.)*?)"+l,"g");t=t.replace(u,function(t,a,i,n){return("function"==typeof e[a]?e[a].apply(o):o.getDataFromObj(a,e))==i?n:""})}if(n)for(var f=0,p=n.length;f<p;f++){var m=n[f];m=m.replace(/([a-zA-Z0-9._-]+):touchnot#([a-zA-Z0-9._-]+)/,"($1):touchnot#($2)");var v=m.replace(/BEGIN/,"END"),g=new RegExp(m+"(([\\n\\r\\t]|.)*?)"+v,"g");t=t.replace(g,function(t,a,i,n){return("function"==typeof e[a]?e[a].apply(o):o.getDataFromObj(a,e))!=i?n:""})}if(r)for(var y=0,x=r.length;y<x;y++){var P=r[y];P=P.replace(/([a-zA-Z0-9._-]+):exist/,"($1):exist");var E=P.replace(/BEGIN/,"END"),w=new RegExp(P+"(([\\n\\r\\t]|.)*?)"+E,"g");t=t.replace(w,function(t,a,i){var n="function"==typeof e[a]?e[a].apply(o):o.getDataFromObj(a,e);return n||0===n?i:""})}if(s)for(var _=0,b=s.length;_<b;_++){var S=s[_];S=S.replace(/([a-zA-Z0-9._-]+):empty/,"($1):empty");var N=S.replace(/BEGIN/,"END"),I=new RegExp(S+"(([\\n\\r\\t]|.)*?)"+N,"g");t=t.replace(I,function(t,a,i){var n="function"==typeof e[a]?e[a].apply(o):o.getDataFromObj(a,e);return n||0===n?"":i})}return t=t.replace(/{([a-zA-Z0-9._-]+)}(\[([a-zA-Z0-9._-]+)\])*/g,function(t,i,n,r){var s=void 0;if("i"==i)s=a;else{if(!e[i]&&0!==e[i])return r&&o.convert&&o.convert[r]?o.convert[r].call(o,""):"";s="function"==typeof e[i]?e[i].apply(o):e[i]}return r&&o.convert&&o.convert[r]?o.convert[r].call(o,s):s})}},{key:"resolveAbsBlock",value:function(t){var e=this;return t=t.replace(/{(.*?)}/g,function(t,a){var o=e.getDataByString(a);return void 0!==o?"function"==typeof o?o.apply(e):o:t})}},{key:"resolveInclude",value:function(t){return t=t.replace(/<!-- #include id="(.*?)" -->/g,function(t,e){return d("#"+e).innerHTML})}},{key:"resolveWith",value:function(t){return t=t.replace(/<!-- BEGIN ([a-zA-Z0-9._-]+):with -->(([\n\r\t]|.)*?)<!-- END ([a-zA-Z0-9._-]+):with -->/g,function(t,e,a){return t=t.replace(/data\-bind=['"](.*?)['"]/g,"data-bind='"+e+".$1'")})}},{key:"resolveLoop",value:function(t){var e=this;return t=t.replace(/<!-- BEGIN (.+?):loop -->(([\n\r\t]|.)*?)<!-- END (.+?):loop -->/g,function(t,a,o){var i=e.getDataByString(a),n=[];n="function"==typeof i?i.apply(e):i;var r="";if(n instanceof Array)for(var s=0,h=n.length;s<h;s++)r+=e.resolveBlock(o,n[s],s);return r=r.replace(/\\([^\\])/g,"$1")})}},{key:"removeData",value:function(t){var e=this.data;for(var a in e)for(var o=0,i=t.length;o<i;o++)a===t[o]&&delete e[a];return this}},{key:"hasLoop",value:function(t){return!!t.match(/<!-- BEGIN (.+?):loop -->(([\n\r\t]|.)*?)<!-- END (.+?):loop -->/g)}},{key:"getHtml",value:function(t,e){var a=this.atemplate.find(function(e){return e.id===t}),o="";if(a&&a.html&&(o=a.html),e&&(o=t),!o)return"";var i=this.data;for(o=this.resolveInclude(o),o=this.resolveWith(o);this.hasLoop(o);)o=this.resolveLoop(o);return o=this.resolveBlock(o,i),o=o.replace(/\\([^\\])/g,"$1"),o=this.resolveAbsBlock(o),o.replace(/^([\t ])*\n/gm,"")}},{key:"update",value:function(t,e){var a=(this.getHtml(),this.templates),o=t||"html";this.beforeUpdated&&this.beforeUpdated();for(var i=0,r=a.length;i<r;i++){var s=a[i],h="#"+s,c=this.getHtml(s),l=d("[data-id='"+s+"']");if((!e||e==s)&&(l?"text"===o?l.innerText=c:n(l,"<div data-id='"+s+"'>"+c+"</div>"):(d(h).insertAdjacentHTML("afterend",'<div data-id="'+s+'"></div>'),"text"===o?d("[data-id='"+s+"']").innerText=c:d("[data-id='"+s+"']").innerHTML=c),e))break}return this.updateBindingData(e),this.onUpdated&&this.onUpdated(e),this}},{key:"updateBindingData",value:function(t){for(var e=this,a=this.templates,o=0,i=a.length;o<i;o++){var n=a[o];if(!t||t==n){var r=d("[data-id='"+n+"']"),s=r.querySelectorAll("[data-bind]");if([].forEach.call(s,function(t){var a=e.getDataByString(t.getAttribute("data-bind"));"checkbox"===t.getAttribute("type")||"radio"===t.getAttribute("type")?a==t.value&&(t.checked=!0):t.value=a}),t)break}}return this}},{key:"applyMethod",value:function(t){var e=[].splice.call(arguments,0);return e.shift(),this.method[t].apply(this,e)}},{key:"getComputedProp",value:function(t){return this.data[t].apply(this)}},{key:"remove",value:function(t){for(var e=this.data,a=t.split(".");a.length>1;)e=e[a.shift()];var o=a.shift();return o.match(/^\d+$/)?e.splice(Number(o),1):delete e[o],this}}]),t}();e.exports=p},{delegate:3,morphdom:5}],2:[function(t,e,a){function o(t,e){for(;t&&t.nodeType!==i;){if(t.matches(e))return t;t=t.parentNode}}var i=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}e.exports=o},{}],3:[function(t,e,a){function o(t,e,a,o,n){var r=i.apply(this,arguments);return t.addEventListener(a,r,n),{destroy:function(){t.removeEventListener(a,r,n)}}}function i(t,e,a,o){return function(a){a.delegateTarget=n(a.target,e),a.delegateTarget&&o.call(t,a)}}var n=t("./closest");e.exports=o},{"./closest":2}],4:[function(e,a,o){(function(e){!function(e){function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(){for(var t=0;t<S.length;t++)S[t][0](S[t][1]);S=[],y=!1}function n(t,e){S.push([t,e]),y||(y=!0,b(i,0))}function r(t,e){function a(t){c(e,t)}function o(t){l(e,t)}try{t(a,o)}catch(t){o(t)}}function s(t){var e=t.owner,a=e.state_,o=e.data_,i=t[a],n=t.then;if("function"==typeof i){a=E;try{o=i(o)}catch(t){l(n,t)}}h(n,o)||(a===E&&c(n,o),a===w&&l(n,o))}function h(t,e){var a;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var o=e.then;if("function"==typeof o)return o.call(e,function(o){a||(a=!0,e!==o?c(t,o):d(t,o))},function(e){a||(a=!0,l(t,e))}),!0}}catch(e){return a||l(t,e),!0}return!1}function c(t,e){t!==e&&h(t,e)||d(t,e)}function d(t,e){t.state_===x&&(t.state_=P,t.data_=e,n(f,t))}function l(t,e){t.state_===x&&(t.state_=P,t.data_=e,n(p,t))}function u(t){var e=t.then_;t.then_=void 0;for(var a=0;a<e.length;a++)s(e[a])}function f(t){t.state_=E,u(t)}function p(t){t.state_=w,u(t)}function m(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof m==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],r(t,this)}var v=e.Promise,g=v&&"resolve"in v&&"reject"in v&&"all"in v&&"race"in v&&function(){var t;return new v(function(e){t=e}),"function"==typeof t}();void 0!==o&&o?(o.Promise=g?v:m,o.Polyfill=m):"function"==typeof t&&t.amd?t(function(){return g?v:m}):g||(e.Promise=m);var y,x="pending",P="sealed",E="fulfilled",w="rejected",_=function(){},b="undefined"!=typeof setImmediate?setImmediate:setTimeout,S=[];m.prototype={constructor:m,state_:x,then_:null,data_:void 0,then:function(t,e){var a={owner:this,then:new this.constructor(_),fulfilled:t,rejected:e};return this.state_===E||this.state_===w?n(s,a):this.then_.push(a),a.then},catch:function(t){return this.then(null,t)}},m.all=function(t){var e=this;if(!a(t))throw new TypeError("You must pass an array to Promise.all().");return new e(function(e,a){for(var o,i=[],n=0,r=0;r<t.length;r++)o=t[r],o&&"function"==typeof o.then?o.then(function(t){return n++,function(a){i[t]=a,--n||e(i)}}(r),a):i[r]=o;n||e(i)})},m.race=function(t){var e=this;if(!a(t))throw new TypeError("You must pass an array to Promise.race().");return new e(function(e,a){for(var o,i=0;i<t.length;i++)o=t[i],o&&"function"==typeof o.then?o.then(e,a):e(o)})},m.resolve=function(t){var e=this;return t&&"object"==typeof t&&t.constructor===e?t:new e(function(e){e(t)})},m.reject=function(t){return new this(function(e,a){a(t)})}}("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,a){"use strict";function o(t){!l&&p.createRange&&(l=p.createRange(),l.selectNode(p.body));var e;return l&&l.createContextualFragment?e=l.createContextualFragment(t):(e=p.createElement("body"),e.innerHTML=t),e.childNodes[0]}function i(t,e){var a=t.nodeName,o=e.nodeName;return a===o||!!(e.actualize&&a.charCodeAt(0)<91&&o.charCodeAt(0)>90)&&a===o.toUpperCase()}function n(t,e){return e&&e!==f?p.createElementNS(e,t):p.createElement(t)}function r(t,e){for(var a=t.firstChild;a;){var o=a.nextSibling;e.appendChild(a),a=o}return e}function s(t,e){var a,o,i,n,r,s=e.attributes;for(a=s.length-1;a>=0;--a)o=s[a],i=o.name,n=o.namespaceURI,r=o.value,n?(i=o.localName||i,t.getAttributeNS(n,i)!==r&&t.setAttributeNS(n,i,r)):t.getAttribute(i)!==r&&t.setAttribute(i,r);for(s=t.attributes,a=s.length-1;a>=0;--a)o=s[a],!1!==o.specified&&(i=o.name,n=o.namespaceURI,n?(i=o.localName||i,v(e,n,i)||t.removeAttributeNS(n,i)):v(e,null,i)||t.removeAttribute(i))}function h(t,e,a){t[a]!==e[a]&&(t[a]=e[a],t[a]?t.setAttribute(a,""):t.removeAttribute(a,""))}function c(){}function d(t){return t.id}var l,u,f="http://www.w3.org/1999/xhtml",p="undefined"==typeof document?void 0:document,m=p?p.body||p.createElement("div"):{};u=m.hasAttributeNS?function(t,e,a){return t.hasAttributeNS(e,a)}:m.hasAttribute?function(t,e,a){return t.hasAttribute(a)}:function(t,e,a){return null!=t.getAttributeNode(e,a)};var v=u,g={OPTION:function(t,e){h(t,e,"selected")},INPUT:function(t,e){h(t,e,"checked"),h(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),v(e,null,"value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var a=e.value;if(t.value!==a&&(t.value=a),t.firstChild){if(""===a&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=a}},SELECT:function(t,e){if(!v(e,null,"multiple")){for(var a=0,o=e.firstChild;o;){var i=o.nodeName;if(i&&"OPTION"===i.toUpperCase()){if(v(o,null,"selected")){a;break}a++}o=o.nextSibling}t.selectedIndex=a}}},y=1,x=3,P=8,E=function(t){return function(e,a,s){function h(t){w?w.push(t):w=[t]}function l(t,e){if(t.nodeType===y)for(var a=t.firstChild;a;){var o=void 0;e&&(o=_(a))?h(o):(A(a),a.firstChild&&l(a,e)),a=a.nextSibling}}function u(t,e,a){!1!==k(t)&&(e&&e.removeChild(t),A(t),l(t,a))}function f(t){if(t.nodeType===y)for(var e=t.firstChild;e;){var a=_(e);a&&(C[a]=e),f(e),e=e.nextSibling}}function m(t){S(t);for(var e=t.firstChild;e;){var a=e.nextSibling,o=_(e);if(o){var n=C[o];n&&i(e,n)&&(e.parentNode.replaceChild(n,e),v(n,e))}m(e),e=a}}function v(o,n,r){var s,c=_(n);if(c&&delete C[c],!a.isSameNode||!a.isSameNode(e)){if(!r){if(!1===N(o,n))return;if(t(o,n),I(o),!1===B(o,n))return}if("TEXTAREA"!==o.nodeName){var d,l,f,E,w=n.firstChild,S=o.firstChild;t:for(;w;){for(f=w.nextSibling,d=_(w);S;){if(l=S.nextSibling,w.isSameNode&&w.isSameNode(S)){w=f,S=l;continue t}s=_(S);var k=S.nodeType,A=void 0;if(k===w.nodeType&&(k===y?(d?d!==s&&((E=C[d])?S.nextSibling===E?A=!1:(o.insertBefore(E,S),l=S.nextSibling,s?h(s):u(S,o,!0),S=E):A=!1):s&&(A=!1),(A=!1!==A&&i(S,w))&&v(S,w)):k!==x&&k!=P||(A=!0,S.nodeValue=w.nodeValue)),A){w=f,S=l;continue t}s?h(s):u(S,o,!0),S=l}if(d&&(E=C[d])&&i(E,w))o.appendChild(E),v(E,w);else{var D=b(w);!1!==D&&(D&&(w=D),w.actualize&&(w=w.actualize(o.ownerDocument||p)),o.appendChild(w),m(w))}w=f,S=l}for(;S;)l=S.nextSibling,(s=_(S))?h(s):u(S,o,!0),S=l}var z=g[o.nodeName];z&&z(o,n)}}if(s||(s={}),"string"==typeof a)if("#document"===e.nodeName||"HTML"===e.nodeName){var E=a;a=p.createElement("html"),a.innerHTML=E}else a=o(a);var w,_=s.getNodeKey||d,b=s.onBeforeNodeAdded||c,S=s.onNodeAdded||c,N=s.onBeforeElUpdated||c,I=s.onElUpdated||c,k=s.onBeforeNodeDiscarded||c,A=s.onNodeDiscarded||c,B=s.onBeforeElChildrenUpdated||c,D=!0===s.childrenOnly,C={};f(e);var z=e,T=z.nodeType,G=a.nodeType;if(!D)if(T===y)G===y?i(e,a)||(A(e),z=r(e,n(a.nodeName,a.namespaceURI))):z=a;else if(T===x||T===P){if(G===T)return z.nodeValue=a.nodeValue,z;z=a}if(z===a)A(e);else if(v(z,a,D),w)for(var O=0,X=w.length;O<X;O++){var M=C[w[O]];M&&u(M,M.parentNode,!1)}return!D&&z!==e&&e.parentNode&&(z.actualize&&(z=z.actualize(e.ownerDocument||p)),e.parentNode.replaceChild(z,e)),z}}(s);e.exports=E},{}],6:[function(t,e,a){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r=function(){function t(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,a,o){return a&&t(e.prototype,a),o&&t(e,o),e}}(),s=t("a-template"),h=function(t){return t&&t.__esModule?t:{default:t}}(s),c='<div class="\\{classNames.smartPhoto\\}"\x3c!-- BEGIN hide:exist --\x3e aria-hidden="true"\x3c!-- END hide:exist --\x3e\x3c!-- BEGIN hide:empty --\x3e aria-hidden="false"\x3c!-- END hide:empty --\x3e role="dialog">\n\t<div class="\\{classNames.smartPhotoBody\\}">\n\t\t<div class="\\{classNames.smartPhotoInner\\}">\n\t\t\t   <div class="\\{classNames.smartPhotoHeader\\}">\n\t\t\t\t\t<span class="\\{classNames.smartPhotoCount\\}">{currentIndex}[increment]/{total}</span>\n\t\t\t\t\t<span class="\\{classNames.smartPhotoCaption\\}" aria-live="polite" tabindex="-1">\x3c!-- BEGIN groupItems:loop --\x3e\x3c!-- \\BEGIN currentIndex:touch#{index} --\x3e{caption}\x3c!-- \\END currentIndex:touch#{index} --\x3e\x3c!-- END groupItems:loop --\x3e</span>\n\t\t\t\t\t<button class="\\{classNames.smartPhotoDismiss\\}" data-action-click="hidePhoto()"><span class="smartphoto-sr-only">\\{message.closeDialog\\}</span></button>\n\t\t\t\t</div>\n\t\t\t\t<div class="\\{classNames.smartPhotoContent\\}"\x3c!-- BEGIN isSmartPhone:exist --\x3e data-action-touchstart="beforeDrag" data-action-touchmove="onDrag" data-action-touchend="afterDrag(false)"\x3c!-- END isSmartPhone:exist --\x3e>\n\t\t\t\t</div>\n\t\t\t\t<ul style="transform:translate({translateX}px,{translateY}px);" class="\\{classNames.smartPhotoList\\}\x3c!-- BEGIN onMoveClass:exist --\x3e \\{classNames.smartPhotoListOnMove\\}\x3c!-- END onMoveClass:exist --\x3e">\n\t\t\t\t\t\x3c!-- BEGIN groupItems:loop --\x3e\n\t\t\t\t\t<li style="transform:translate({translateX}px,{translateY}px);" class="\x3c!-- \\BEGIN currentIndex:touch#{index} --\x3ecurrent\x3c!-- \\END currentIndex:touch#{index} --\x3e">\n\t\t\t\t\t\t\x3c!-- BEGIN processed:exist --\x3e\n\t\t\t\t\t\t<div style="transform:translate({x}px,{y}px) scale({scale});" class="\\\\{classNames.smartPhotoImgWrap\\\\}"\x3c!-- \\BEGIN isSmartPhone:empty --\x3e data-action-mousemove="onDrag" data-action-mousedown="beforeDrag" data-action-mouseup="afterDrag"\x3c!-- \\END isSmartPhone:empty --\x3e\x3c!-- \\BEGIN isSmartPhone:exist --\x3e data-action-touchstart="beforeDrag" data-action-touchmove="onDrag" data-action-touchend="afterDrag"\x3c!-- \\END isSmartPhone:exist --\x3e>\n\t\t\t\t\t\t\t<img style="\x3c!-- \\BEGIN currentIndex:touch#{index} --\x3etransform:translate(\\{photoPosX\\}[virtualPos]px,\\{photoPosY\\}[virtualPos]px) scale(\\{scaleSize\\});\x3c!-- \\END currentIndex:touch#{index} --\x3e" src="{src}" class="\\\\{classNames.smartPhotoImg\\\\}\x3c!-- \\BEGIN scale:exist --\x3e  \\\\{classNames.smartPhotoImgOnMove\\\\}\x3c!-- \\END scale:exist --\x3e\x3c!-- \\BEGIN elastic:exist --\x3e \\\\{classNames.smartPhotoImgElasticMove\\\\}\x3c!-- \\END elastic:exist --\x3e\x3c!-- \\BEGIN appear:exist --\x3e active\x3c!-- \\END appear:exist --\x3e" ondragstart="return false;">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- END processed:exist --\x3e\n\t\t\t\t\t\t\x3c!-- BEGIN processed:empty --\x3e\n\t\t\t\t\t\t<div class="\\\\{classNames.smartPhotoLoaderWrap\\\\}">\n\t\t\t\t\t\t\t<span class="\\\\{classNames.smartPhotoLoader\\\\}"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- END processed:empty --\x3e\n\t\t\t\t\t</li>\n\t\t\t\t\t\x3c!-- END groupItems:loop --\x3e\n\t\t\t\t</ul>\n\t\t\t\t\x3c!-- BEGIN arrows:exist --\x3e\n\t\t\t\t<ul class="\\{classNames.smartPhotoArrows\\}"\x3c!-- BEGIN hideUi:exist --\x3e aria-hidden="true"\x3c!-- END hideUi:exist --\x3e\x3c!-- BEGIN hideUi:exist --\x3e aria-hidden="false"\x3c!-- END hideUi:exist --\x3e>\n\t\t\t\t\t<li class="\\{classNames.smartPhotoArrowLeft\\}"\x3c!-- BEGIN showPrevArrow:empty --\x3e aria-hidden="true"\x3c!-- END showPrevArrow:empty --\x3e><a href="#" data-action-click="gotoSlide({prev})" role="button"><span class="smartphoto-sr-only">\\{message.gotoPrevImage\\}</span></a></li>\n\t\t\t\t\t<li class="\\{classNames.smartPhotoArrowRight\\}"\x3c!-- BEGIN showNextArrow:empty --\x3e aria-hidden="true"\x3c!-- END showNextArrow:empty --\x3e><a href="#" data-action-click="gotoSlide({next})" role="button"><span class="smartphoto-sr-only">\\{message.gotoNextImage\\}</span></a></li>\n\t\t\t\t</ul>\n\t\t\t\t\x3c!-- END arrows:exist --\x3e\n\t\t\t\t\x3c!-- BEGIN nav:exist --\x3e\n\t\t\t\t<nav class="\\{classNames.smartPhotoNav\\}"\x3c!-- BEGIN hideUi:exist --\x3e aria-hidden="true"\x3c!-- END hideUi:exist --\x3e\x3c!-- BEGIN hideUi:exist --\x3e aria-hidden="false"\x3c!-- END hideUi:exist --\x3e>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t\x3c!-- BEGIN groupItems:loop --\x3e\n\t\t\t\t\t\t<li><a href="#" data-action-click="gotoSlide({index})" class="\x3c!-- \\BEGIN currentIndex:touch#{index} --\x3ecurrent\x3c!-- \\END currentIndex:touch#{index} --\x3e" style="background-image:url({src});" role="button"><span class="smartphoto-sr-only">go to {caption}</span></a></li>\n\t\t\t\t\t\t\x3c!-- END groupItems:loop --\x3e\n\t\t\t\t\t</ul>\n\t\t\t\t</nav>\n\t\t\t\t\x3c!-- END nav:exist --\x3e\n\t\t</div>\n\t\t\x3c!-- BEGIN appearEffect:exist --\x3e\n\t\t<img src=\\{appearEffect.img\\}\n\t\tclass="\\{classNames.smartPhotoImgClone\\}"\n\t\tstyle="width:\\{appearEffect.width\\}px;height:\\{appearEffect.height\\}px;transform:translate(\\{appearEffect.left\\}px,\\{appearEffect.top\\}px) scale(1)" />\n\t\t\x3c!-- END appearEffect:exist --\x3e\n\t</div>\n</div>\n',d=t("../lib/util"),l=t("es6-promise-polyfill").Promise,u={classNames:{smartPhoto:"smartphoto",smartPhotoClose:"smartphoto-close",smartPhotoBody:"smartphoto-body",smartPhotoInner:"smartphoto-inner",smartPhotoContent:"smartphoto-content",smartPhotoImg:"smartphoto-img",smartPhotoImgOnMove:"smartphoto-img-onmove",smartPhotoImgElasticMove:"smartphoto-img-elasticmove",smartPhotoImgWrap:"smartphoto-img-wrap",smartPhotoArrows:"smartphoto-arrows",smartPhotoNav:"smartphoto-nav",smartPhotoArrowRight:"smartphoto-arrow-right",smartPhotoArrowLeft:"smartphoto-arrow-left",smartPhotoImgLeft:"smartphoto-img-left",smartPhotoImgRight:"smartphoto-img-right",smartPhotoList:"smartphoto-list",smartPhotoListOnMove:"smartphoto-list-onmove",smartPhotoHeader:"smartphoto-header",smartPhotoCount:"smartphoto-count",smartPhotoCaption:"smartphoto-caption",smartPhotoDismiss:"smartphoto-dismiss",smartPhotoLoader:"smartphoto-loader",smartPhotoLoaderWrap:"smartphoto-loader-wrap",smartPhotoImgClone:"smartphoto-img-clone"},message:{gotoNextImage:"go to the next image",gotoPrevImage:"go to the previous image",closeDialog:"close the image dialog"},arrows:!0,nav:!0,animationSpeed:300,swipeOffset:100,headerHeight:60,footerHeight:60,forceInterval:10,registance:.5,resizeStyle:"fill",verticalGravity:!1,useOrientationApi:!0},f=function(t){function e(t,a){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n.data=d.extend({},u,a),n.data.currentIndex=0,n.data.oldIndex=0,n.data.hide=!0,n.data.group={},n.data.scaleSize=1,n.data.scale=!1,n.pos={x:0,y:0},n.data.photoPosX=0,n.data.photoPosY=0,n.convert={increment:n.increment,virtualPos:n.virtualPos},n.data.groupItems=n.groupItems,n.elements=document.querySelectorAll(t);var r=new Date;n.tapSecond=r.getTime(),n.onListMove=!1,n.clicked=!1,n.id=n._getUniqId(),n.vx=0,n.vy=0,n.data.appearEffect=null,n.addTemplate(n.id,c),n.data.isSmartPhone=n._isSmartPhone();var s=document.querySelector("body");d.append(s,"<div data-id='"+n.id+"'></div>"),[].forEach.call(n.elements,function(t){n.addNewItem(t)});var h=n._getCurrentItemByHash();return h&&d.triggerEvent(h.element,"click"),n.update(),n._getEachImageSize().then(function(){n._fireEvent("loadall")}),setInterval(function(){n._doAnim()},n.data.forceInterval),n.data.isSmartPhone?(window.addEventListener("orientationchange",function(){n._resetTranslate(),n._setPosByCurrentIndex(),n._setHashByCurrentIndex(),n._setSizeByScreen(),n.update()}),n.data.useOrientationApi?(window.addEventListener("deviceorientation",function(t){var e=window.orientation;t&&t.gamma&&!n.data.appearEffect&&(n.isBeingZoomed||n.photoSwipable||n.data.elastic||!n.data.scale||(0===e?n._calcGravity(t.gamma,t.beta):90===e?n._calcGravity(t.beta,t.gamma):-90===e?n._calcGravity(-t.beta,-t.gamma):180===e&&n._calcGravity(-t.gamma,-t.beta)))}),n):i(n)):(window.addEventListener("resize",function(){n._resetTranslate(),n._setPosByCurrentIndex(),n._setSizeByScreen(),n.update()}),window.addEventListener("keydown",function(t){var e=t.keyCode||t.which;!0!==n.data.hide&&(37===e?n.gotoSlide(n.data.prev):39===e?n.gotoSlide(n.data.next):27===e&&n.hidePhoto())}),i(n))}return n(e,t),r(e,[{key:"on",value:function(t,e){var a=this;this._getElementByClass(this.data.classNames.smartPhoto).addEventListener(t,function(t){e.call(a,t)})}},{key:"increment",value:function(t){return t+1}},{key:"virtualPos",value:function(t){return(t=parseInt(t,10))/this._getSelectedItem().scale/this.data.scaleSize}},{key:"groupItems",value:function(){return this.data.group[this.data.currentGroup]}},{key:"_getEachImageSize",value:function(){var t=[],e=this.data.group,a=function(e){var a=new l(function(t,a){var o=new Image;o.onload=function(){e.width=o.width,e.height=o.height,e.loaded=!0,t()},o.onerror=function(){a()},o.src=e.src});t.push(a)};return Object.keys(e).forEach(function(t){e[t].forEach(a)}),l.all(t)}},{key:"_resetTranslate",value:function(){var t=this;this.groupItems().forEach(function(e,a){e.translateX=t._getWindowWidth()*a})}},{key:"addNewItem",value:function(t){var e=this,a=t.getAttribute("data-group")||"nogroup",o=this.data.group;"nogroup"===a&&t.setAttribute("data-group","nogroup"),o[a]||(o[a]=[]);var i=o[a].length,n={src:t.getAttribute("href"),caption:t.getAttribute("data-caption"),groupId:a,translateX:this._getWindowWidth()*i,index:i,translateY:0,width:50,height:50,id:t.getAttribute("data-id")||i,loaded:!1,processed:!1,element:t};o[a].push(n),this.data.currentGroup=a,t.getAttribute("data-id")||t.setAttribute("data-id",i),t.setAttribute("data-index",i),t.addEventListener("click",function(a){a.preventDefault(),e.data.currentGroup=t.getAttribute("data-group"),e.data.currentIndex=parseInt(t.getAttribute("data-index"),10),e._setHashByCurrentIndex();var o=e._getSelectedItem();o.loaded?(e._initPhoto(),e.addAppearEffect(t),e.clicked=!0,e.update(),e._fireEvent("open")):e._loadItem(o).then(function(){e._initPhoto(),e.addAppearEffect(t),e.clicked=!0,e.update(),e._fireEvent("open")})})}},{key:"_initPhoto",value:function(){this.data.total=this.groupItems().length,this.data.hide=!1,this.data.photoPosX=0,this.data.photoPosY=0,this._setPosByCurrentIndex(),this._setSizeByScreen(),this.setArrow(),"fill"===this.data.resizeStyle&&this.data.isSmartPhone&&(this.data.scale=!0,this.data.hideUi=!0,this.data.scaleSize=this._getScaleBoarder())}},{key:"onUpdated",value:function(){var t=this;if(this.data.appearEffect&&this.data.appearEffect.once&&(this.data.appearEffect.once=!1,this.execEffect().then(function(){t.data.appearEffect=null,t.data.appear=!0,t.update()})),this.clicked){this.clicked=!1;var e=this.data.classNames;this._getElementByClass(e.smartPhotoCaption).focus()}}},{key:"execEffect",value:function(){var t=this;return new l(function(e){var a=t.data.appearEffect,o=t.data.classNames,i=t._getElementByClass(o.smartPhotoImgClone),n=function t(){i.removeEventListener("transitionend",t,!0),e()};i.addEventListener("transitionend",n,!0),setTimeout(function(){i.style.transform="translate("+a.afterX+"px, "+a.afterY+"px) scale("+a.scale+")"},10)})}},{key:"addAppearEffect",value:function(t){var e=t.querySelector("img"),a=d.getViewPos(e),o={},i=1;o.width=e.offsetWidth,o.height=e.offsetHeight,o.top=a.top,o.left=a.left,o.once=!0,o.img=e.getAttribute("src");var n=this._getWindowWidth(),r=this._getWindowHeight(),s=r-this.data.headerHeight-this.data.footerHeight;"fill"===this.data.resizeStyle&&this.data.isSmartPhone?i=e.offsetWidth>e.offsetHeight?r/e.offsetHeight:n/e.offsetWidth:(i=s/e.offsetHeight)*e.offsetWidth>n&&(i=n/e.offsetWidth);var h=(i-1)/2*e.offsetWidth+(n-e.offsetWidth*i)/2,c=(i-1)/2*e.offsetHeight+(r-e.offsetHeight*i)/2;o.afterX=h,o.afterY=c,o.scale=i,this.data.appearEffect=o}},{key:"hidePhoto",value:function(){var t=this;this.data.hide=!0,this.data.appear=!1,this.data.appearEffect=null,this.data.hideUi=!1,this.data.scale=!1,this.data.scaleSize=1;var e=window.scrollX,a=window.scrollY;location.hash&&this._setHash(""),window.scroll(e,a),this._doHideEffect().then(function(){t.update(),t._fireEvent("close")})}},{key:"_doHideEffect",value:function(){var t=this;return new l(function(e){var a=t.data.classNames,o=t._getElementByClass(a.smartPhoto),i=t._getElementByQuery(".current ."+a.smartPhotoImg),n=t._getWindowHeight(),r=function t(){o.removeEventListener("transitionend",t,!0),e()};o.style.opacity=0,i.style.transform="translateY("+n+"px)",o.addEventListener("transitionend",r,!0)})}},{key:"_getElementByClass",value:function(t){return document.querySelector('[data-id="'+this.id+'"] .'+t)}},{key:"_getElementByQuery",value:function(t){return document.querySelector('[data-id="'+this.id+'"] '+t)}},{key:"_getTouchPos",value:function(){var t=0,e=0,a="undefined"==typeof event?this.e:event;return this._isTouched(a)?(t=a.touches[0].pageX,e=a.touches[0].pageY):a.pageX&&(t=a.pageX,e=a.pageY),{x:t,y:e}}},{key:"_getGesturePos",
value:function(t){var e=t.touches;return[{x:e[0].pageX,y:e[0].pageY},{x:e[1].pageX,y:e[1].pageY}]}},{key:"_setPosByCurrentIndex",value:function(){var t=this,e=this.groupItems(),a=-1*e[this.data.currentIndex].translateX;this.pos.x=a,setTimeout(function(){t.data.translateX=a,t.data.translateY=0,t._listUpdate()},1)}},{key:"_setHashByCurrentIndex",value:function(){var t=window.scrollX,e=window.scrollY,a=this.groupItems(),o=a[this.data.currentIndex].id,i=this.data.currentGroup,n="group="+i+"&photo="+o;this._setHash(n),window.scroll(t,e)}},{key:"_setHash",value:function(t){window.history&&window.history.pushState&&(t?window.history.replaceState(null,null,location.pathname+"#"+t):window.history.replaceState(null,null,""+location.pathname))}},{key:"_getCurrentItemByHash",value:function(){var t=this.data.group,e=location.hash.substr(1),a=d.parseQuery(e),o=null,i=function(t){a.group===t.groupId&&a.photo===t.id&&(o=t)};return Object.keys(t).forEach(function(e){t[e].forEach(i)}),o}},{key:"_loadItem",value:function(t){return new l(function(e){var a=new Image;a.onload=function(){t.width=a.width,t.height=a.height,t.loaded=!0,e()},a.onerror=function(){e()},a.src=t.src})}},{key:"_setSizeByScreen",value:function(){var t=this._getWindowWidth(),e=this._getWindowHeight(),a=this.data.headerHeight,o=this.data.footerHeight,i=e-(a+o);this.groupItems().forEach(function(a){a.loaded&&(a.processed=!0,a.scale=i/a.height,a.x=(a.scale-1)/2*a.width+(t-a.width*a.scale)/2,a.y=(a.scale-1)/2*a.height+(e-a.height*a.scale)/2,a.width*a.scale>t&&(a.scale=t/a.width,a.x=(a.scale-1)/2*a.width))})}},{key:"_slideList",value:function(){var t=this;this.data.scaleSize=1,this.isBeingZoomed=!1,this.data.hideUi=!1,this.data.scale=!1,this.data.photoPosX=0,this.data.photoPosY=0,this.data.onMoveClass=!0,this._setPosByCurrentIndex(),this._setHashByCurrentIndex(),this._setSizeByScreen(),setTimeout(function(){t.data.onMoveClass=!1,t.setArrow(),t.update(),t.data.oldIndex!==t.data.currentIndex&&t._fireEvent("change"),t.data.oldIndex=t.data.currentIndex},200)}},{key:"gotoSlide",value:function(t){this.e&&this.e.preventDefault&&this.e.preventDefault(),this.data.currentIndex=parseInt(t,10),this.data.currentIndex||(this.data.currentIndex=0),this._slideList()}},{key:"setArrow",value:function(){var t=this.groupItems(),e=t.length,a=this.data.currentIndex+1,o=this.data.currentIndex-1;this.data.showNextArrow=!1,this.data.showPrevArrow=!1,a!==e&&(this.data.next=a,this.data.showNextArrow=!0),-1!==o&&(this.data.prev=o,this.data.showPrevArrow=!0)}},{key:"beforeDrag",value:function(){if(this._isGestured(this.e))return void this.beforeGesture();if(this.isBeingZoomed=!1,this.data.scale)return void this.beforePhotoDrag();var t=this._getTouchPos();this.isSwipable=!0,this.dragStart=!0,this.firstPos=t,this.oldPos=t}},{key:"afterDrag",value:function(){var t=this.groupItems(),e=new Date,a=e.getTime(),o=this.tapSecond-a,i=0,n=0;return this.isSwipable=!1,this.onListMove=!1,this.oldPos&&(i=this.oldPos.x-this.firstPos.x,n=this.oldPos.y-this.firstPos.y),this.isBeingZoomed?void this.afterGesture():this.data.scale?void this.afterPhotoDrag():d.isSmartPhone()||0!==i||0!==n?Math.abs(o)<=500&&0===i&&0===n?(this.e.preventDefault(),void this.zoomPhoto()):(this.tapSecond=a,this._fireEvent("swipeend"),"horizontal"===this.moveDir&&(i>=this.data.swipeOffset&&0!==this.data.currentIndex?this.data.currentIndex-=1:i<=-this.data.swipeOffset&&this.data.currentIndex!==t.length-1&&(this.data.currentIndex+=1),this._slideList()),void("vertical"===this.moveDir&&(n>=this.data.swipeOffset?this.hidePhoto():(this.data.translateY=0,this._slideList())))):void this.zoomPhoto()}},{key:"onDrag",value:function(){if(this.e.preventDefault(),this._isGestured(this.e)&&!1===this.onListMove)return void this.onGesture();if(!this.isBeingZoomed){if(this.data.scale)return void this.onPhotoDrag();if(this.isSwipable){var t=this._getTouchPos(),e=t.x-this.oldPos.x,a=t.y-this.firstPos.y;this.dragStart&&(this._fireEvent("swipestart"),this.dragStart=!1,Math.abs(e)>Math.abs(a)?this.moveDir="horizontal":this.moveDir="vertical"),"horizontal"===this.moveDir?(this.pos.x+=e,this.data.translateX=this.pos.x):this.data.translateY=a,this.onListMove=!0,this.oldPos=t,this._listUpdate()}}}},{key:"zoomPhoto",value:function(){var t=this;this.data.hideUi=!0,this.data.scaleSize=this._getScaleBoarder(),this.data.photoPosX=0,this.data.photoPosY=0,this._photoUpdate(),setTimeout(function(){t.data.scale=!0,t._photoUpdate(),t._fireEvent("zoomin")},300)}},{key:"zoomOutPhoto",value:function(){this.data.scaleSize=1,this.isBeingZoomed=!1,this.data.hideUi=!1,this.data.scale=!1,this.data.photoPosX=0,this.data.photoPosY=0,this._photoUpdate(),this._fireEvent("zoomout")}},{key:"beforePhotoDrag",value:function(){var t=this._getTouchPos();this.photoSwipable=!0,this.data.photoPosX||(this.data.photoPosX=0),this.data.photoPosY||(this.data.photoPosY=0),this.oldPhotoPos=t,this.firstPhotoPos=t}},{key:"onPhotoDrag",value:function(){if(this.photoSwipable){this.e.preventDefault();var t=this._getTouchPos(),e=t.x-this.oldPhotoPos.x,a=t.y-this.oldPhotoPos.y,o=this._round(this.data.scaleSize*e,6),i=this._round(this.data.scaleSize*a,6);"number"==typeof o&&(this.data.photoPosX+=o,this.photoVX=o),"number"==typeof i&&(this.data.photoPosY+=i,this.photoVY=i),this.oldPhotoPos=t,this._photoUpdate()}}},{key:"afterPhotoDrag",value:function(){if(this.oldPhotoPos.x===this.firstPhotoPos.x&&this.photoSwipable)this.photoSwipable=!1,this.zoomOutPhoto();else{this.photoSwipable=!1;var t=this._getSelectedItem(),e=this._makeBound(t),a=this.data.swipeOffset*this.data.scaleSize,o=0,i=0;if(this.data.photoPosX>e.maxX?o=-1:this.data.photoPosX<e.minX&&(o=1),this.data.photoPosY>e.maxY?i=-1:this.data.photoPosY<e.minY&&(i=1),this.data.photoPosX-e.maxX>a&&0!==this.data.currentIndex)return void this.gotoSlide(this.data.prev);if(e.minX-this.data.photoPosX>a&&this.data.currentIndex+1!==this.data.total)return void this.gotoSlide(this.data.next);0===o&&0===i?(this.vx=this.photoVX/5,this.vy=this.photoVY/5):this._registerElasticForce(o,i)}}},{key:"beforeGesture",value:function(){this._fireEvent("gesturestart");var t=this._getGesturePos(this.e),e=this._getDistance(t[0],t[1]);this.isBeingZoomed=!0,this.oldDistance=e,this.data.scale=!0,this.e.preventDefault()}},{key:"onGesture",value:function(){var t=this._getGesturePos(this.e),e=this._getDistance(t[0],t[1]),a=(e-this.oldDistance)/100,o=this.data.scaleSize,i=this.data.photoPosX,n=this.data.photoPosY;this.isBeingZoomed=!0,this.data.scaleSize+=this._round(a,6),this.data.scaleSize<.2&&(this.data.scaleSize=.2),this.data.scaleSize<o&&(this.data.photoPosX=(1+this.data.scaleSize-o)*i,this.data.photoPosY=(1+this.data.scaleSize-o)*n),this.data.scaleSize<1||this.data.scaleSize>this._getScaleBoarder()?this.data.hideUi=!0:this.data.hideUi=!1,this.oldDistance=e,this.e.preventDefault(),this._photoUpdate()}},{key:"afterGesture",value:function(){this.data.scaleSize>this._getScaleBoarder()||(this.data.photoPosX=0,this.data.photoPosY=0,this.data.scale=!1,this.data.scaleSize=1,this.data.hideUi=!1,this._fireEvent("gestureend"),this._photoUpdate())}},{key:"_getForceAndTheta",value:function(t,e){return{force:Math.sqrt(t*t+e*e),theta:Math.atan2(e,t)}}},{key:"_getScaleBoarder",value:function(){var t=this._getSelectedItem(),e=this._getWindowWidth(),a=this._getWindowHeight();return d.isSmartPhone()?t.width>t.height?a/(t.height*t.scale):e/(t.width*t.scale):1/t.scale}},{key:"_makeBound",value:function(t){var e=t.width*t.scale*this.data.scaleSize,a=t.height*t.scale*this.data.scaleSize,o=void 0,i=void 0,n=void 0,r=void 0,s=this._getWindowWidth(),h=this._getWindowHeight();return s>e?(n=(s-e)/2,o=-1*n):(n=(e-s)/2,o=-1*n),h>a?(r=(h-a)/2,i=-1*r):(r=(a-h)/2,i=-1*r),{minX:this._round(o,6)*this.data.scaleSize,minY:this._round(i,6)*this.data.scaleSize,maxX:this._round(n,6)*this.data.scaleSize,maxY:this._round(r,6)*this.data.scaleSize}}},{key:"_registerElasticForce",value:function(t,e){var a=this,o=this._getSelectedItem(),i=this._makeBound(o);this.data.elastic=!0,1===t?this.data.photoPosX=i.minX:-1===t&&(this.data.photoPosX=i.maxX),1===e?this.data.photoPosY=i.minY:-1===e&&(this.data.photoPosY=i.maxY),this._photoUpdate(),setTimeout(function(){a.data.elastic=!1,a._photoUpdate()},300)}},{key:"_getSelectedItem",value:function(){var t=this.data,e=t.currentIndex;return t.group[t.currentGroup][e]}},{key:"_getUniqId",value:function(){return(Date.now().toString(36)+Math.random().toString(36).substr(2,5)).toUpperCase()}},{key:"_getDistance",value:function(t,e){var a=t.x-e.x,o=t.y-e.y;return Math.sqrt(a*a+o*o)}},{key:"_round",value:function(t,e){var a=Math.pow(10,e);return t*=a,t=Math.round(t),t/=a}},{key:"_isTouched",value:function(t){return!(!t||!t.touches)}},{key:"_isGestured",value:function(t){return!!(t&&t.touches&&t.touches.length>1)}},{key:"_isSmartPhone",value:function(){var t=navigator.userAgent;return t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("ipod")>0||t.indexOf("Android")>0}},{key:"_calcGravity",value:function(t,e){(t>5||t<-5)&&(this.vx+=.05*t),!1!==this.data.verticalGravity&&(e>5||e<-5)&&(this.vy+=.05*e)}},{key:"_photoUpdate",value:function(){var t=this.data.classNames,e=this._getElementByQuery(".current"),a=e.querySelector("."+t.smartPhotoImg),o=this._getElementByQuery("."+t.smartPhotoNav),i=this._getElementByQuery("."+t.smartPhotoArrows),n=this.virtualPos(this.data.photoPosX),r=this.virtualPos(this.data.photoPosY),s=this.data.scaleSize,h="translate("+n+"px,"+r+"px) scale("+s+")";a.style.transform=h,this.data.scale?d.addClass(a,t.smartPhotoImgOnMove):d.removeClass(a,t.smartPhotoImgOnMove),this.data.elastic?d.addClass(a,t.smartPhotoImgElasticMove):d.removeClass(a,t.smartPhotoImgElasticMove),this.data.hideUi?(o&&o.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-hidden","true")):(o&&o.setAttribute("aria-hidden","false"),i&&i.setAttribute("aria-hidden","false"))}},{key:"_getWindowWidth",value:function(){return document.documentElement.clientWidth}},{key:"_getWindowHeight",value:function(){return window.innerHeight}},{key:"_listUpdate",value:function(){var t=this.data.classNames,e=this._getElementByQuery("."+t.smartPhotoList),a="translate("+this.data.translateX+"px,"+this.data.translateY+"px)";e.style.transform=a,this.data.onMoveClass?d.addClass(e,t.smartPhotoListOnMove):d.removeClass(e,t.smartPhotoListOnMove)}},{key:"_fireEvent",value:function(t){var e=this._getElementByClass(this.data.classNames.smartPhoto);d.triggerEvent(e,t)}},{key:"_doAnim",value:function(){if(!(this.isBeingZoomed||this.isSwipable||this.photoSwipable||this.data.elastic)&&this.data.scale){this.data.photoPosX+=this.vx,this.data.photoPosY+=this.vy;var t=this._getSelectedItem(),e=this._makeBound(t);this.data.photoPosX<e.minX?(this.data.photoPosX=e.minX,this.vx*=-.2):this.data.photoPosX>e.maxX&&(this.data.photoPosX=e.maxX,this.vx*=-.2),this.data.photoPosY<e.minY?(this.data.photoPosY=e.minY,this.vy*=-.2):this.data.photoPosY>e.maxY&&(this.data.photoPosY=e.maxY,this.vy*=-.2);var a=this._getForceAndTheta(this.vx,this.vy),o=a.force,i=a.theta;o-=this.data.registance,Math.abs(o)<.5||(this.vx=Math.cos(i)*o,this.vy=Math.sin(i)*o,this._photoUpdate())}}}]),e}(h.default);e.exports=f},{"../lib/util":8,"a-template":1,"es6-promise-polyfill":4}],7:[function(t,e,a){"use strict";e.exports=t("./core/")},{"./core/":6}],8:[function(t,e,a){"use strict";function o(t){t=t||{};for(var e=1;e<arguments.length;e++){var a=arguments[e];if(a)for(var n in a)a.hasOwnProperty(n)&&("object"===i(a[n])?t[n]=o(t[n],a[n]):t[n]=a[n])}return t}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.exports.isSmartPhone=function(){var t=navigator.userAgent;return t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("ipod")>0||t.indexOf("Android")>0},e.exports.extend=o,e.exports.triggerEvent=function(t,e,a){var o=void 0;window.CustomEvent?o=new CustomEvent(e,{cancelable:!0}):(o=document.createEvent("CustomEvent"),o.initCustomEvent(e,!1,!1,a)),t.dispatchEvent(o)},e.exports.parseQuery=function(t){for(var e,a,o,i=t.split("&"),n={},r=0,s=i.length;r<s;r++)e=i[r].split("="),void 0!==e[0]&&(a=e[0],o=void 0!==e[1]?e.slice(1).join("="):a,n[a]=decodeURIComponent(o));return n},e.exports.getViewPos=function(t){return{left:t.getBoundingClientRect().left,top:t.getBoundingClientRect().top}},e.exports.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},e.exports.append=function(t,e){var a=new DOMParser,o=a.parseFromString(e,"text/html");t.appendChild(o.querySelector("body").childNodes[0])},e.exports.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},e.exports.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}},{}]},{},[7])(7)});